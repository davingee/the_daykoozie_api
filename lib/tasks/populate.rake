require 'populator'
require 'faker'
namespace :populate do

  UIDS = uids = ["428936", "575924554", "1390308626", "563967537", "606959073", "28647", "1161404412", "1254030020", "59703132", "570506883", "15501323", "131266203622981", "6828193", "1650970380", "156802609", "100000240262079", "1066950186", "1313241784", "100000940323039", "571551237", "588255761", "1146722294", "100001891817685", "14226536", "575290206", "585305587", "1403444917", "1526738361", "100003264672329", "100002236433420", "539178273", "1347727895", "1297533541", "830062836", "545453932", "100000163629496", "1271477714", "1402536", "1059505312", "790244992", "1509530109", "1310638494", "622658745", "1467390672", "556667836", "712704", "673476409", "1307643950", "1929930", "1150170012", "1380900108", "2358831", "1313359410", "58217392", "1101918435", "671811943", "714685759", "655771793", "100004132596579", "9382896", "1171337465", "682870824", "6112055", "1330770053", "3804187", "535045445", "789908312", "1465830081", "506553239", "1238454877", "509880897", "507996766", "610087249", "1416420391", "1465920010", "0n13CgO8tn", "604911", "100000095138784", "100000243978167", "100000100270494", "635767598", "100000409232171", "1387598255", "671193667", "100000327378139", "1604384726", "500873665", "557890607", "1817766740", "503759527", "1572897250", "672900640", "1011601608", "100000044133429", "1049580687", "1285028223", "3404768", "25705343", "3403601", "54000541", "1547660840", "1317461360", "1051750914", "578984000", "82101424", "742954800", "662828574", "100000863646510", "1042434122", "715301267", "100002985993675", "779674668", "613187789", "1359791150", "652958537", "1039500037", "639898468", "1347446603", "5OE3YV9bb1", "721632645", "597512377", "562679366", "1158487986", "500678723", "1272294782", "100000050297918", "1326392633", "714325629", "739654098", "573998419", "644335791", "1073692644", "875600595", "882350380", "681314778", "1411038219", "1538334197", "504997725", "578690993", "rZHy88u-WX", "703871637", "1538329884", "1222394994", "574202852", "8846372", "714574146", "616885310", "556710019", "1082520333", "100001133950158", "836738679", "653174884", "514087580", "515063129", "100001990212720", "100003942066725", "766274007", "100000917583872", "1074300242", "635220433", "535582746", "1341690607", "1166563639", "1769610658", "100001591696059", "567442425", "557621847", "1347458182", "1417988220", "1768872709", "612024532", "429136", "1376460107", "571792506", "1404703619", "1042154991", "1379921587", "1084120892", "1294223007", "559217360", "1562550561", "690641784", "592206452", "739400421", "1189068207", "2064604", "623549975", "1562580547", "1611002696", "733900410", "1401810047", "1335480004", "1062900305", "1686030025", "513093999", "616251134", "726955568", "659276550", "1476330375", "100000136209796", "3418637", "594370624", "539740288", "624629534", "100002467858120", "815757907", "500572172", "594770526", "1171712963", "1092360360", "506130411", "1444224731", "1600997703", "755510600", "541393024", "1635870070", "1123040821", "560735108", "1372925398", "100002596526841", "1059300043", "553198803", "1196663924", "737573302", "511202521", "qWjCxXFiJh", "12wh2cZ7qg", "1831819664", "DEYXoZ65A9", "eY0EllM9Wx", "692796187", "1023700560", "654534384", "otpQuYXi_w", "1171875099", "679726840", "82800250", "1917398", "100001284076838", "668875115", "1572360115", "TKAzOpsZSy", "783747651", "1026120025", "HEM-pU5MNO", "43102483", "500705906", "HcBwwIKOtz", "46300066", "1406232724", "Df2oDOzDqs", "7zunnQSM6d", "X5lHFsYTj_", "MbaxvruxOS", "b0OLEOm3o1", "5VMg2HMgbm", "10114017", "6827573", "10133740", "1363381808", "655612849", "658339300", "j-rwW8P3n2", "100000154773525", "682590397", "825960454", "802794209", "430193", "1644777682", "ODuvCN7upw", "yShotIi2u3", "100000059739588", "DZiRlx_Odu", "14WWMUB77q", "745864313", "EjdY3u-Ru2", "100002643035662", "1511520056", "100000419036532", "1205701274", "1827979688", "100000223972634", "679845422", "100000866198961", "100005077961911", "542021168", "2608160", "8pk2WfswAY", "0oFgZLSUHF", "qg7XOeDv5E", "IndDgayUG1", "707792787", "518731145", "UHPHbqjnZm", "1825561", "100002027658001", "100000158964346", "1054319755", "100000035227446", "1368750423", "QS7vC139bL", "dC8JvjuqRG", "1026075846", "1126089607", "663056005", "60710839", "6z4outbwPD", "wURi3rxNTk", "1394670045", "NGU5UxnevG", "7ExWZTVA_a", "100000138134595", "100003538456712", "805217169", "665355941", "1390597366", "556143934", "oIBfpTAyw-", "719205164", "100001476527816", "100000543962860", "664050808", "3417355", "1358001510", "500051679", "y_zqgbcpKH", "E9UC6uGJ_d", "at2X4ZvUCn", "5umi533GQp", "q0sBTS0dye", "803365373", "558631111", "510425629", "556704652", "100000476195256", "679116694", "1232460649", "1534244340", "1329759607", "681379611", "531891035", "1240290049", "oZBY3-IT63", "519833096", "knwqzX_pFK", "yBXH965V6N", "100003976828124", "uTQFldLFJ7", "5zm35JsGsD", "100004975691597", "1830363382", "100005098503618", "549915385", "4hZxVgERPd", "100000053596080", "610870161", "594261893", "543373470", "100000301742751", "ibWtIpIkc4", "rhDL4bbC2P", "yVR_FN9Blu", "631909438", "779231962", "f3JPrK7Qx8", "1666300900", "632484938", "fg_5dVIywT", "4EQbBpF3Kx", "Qg6YTKq99S", "1204066136", "507240142", "678262755", "721633337", "100005075641762", "139501366", "11605662", "DFsBWDhImk", "1082610031", "ZsVuCANEs5", "1468020122", "519606447", "EJ-OYiSqcp", "xiTNIyG99P", "100003207476139", "6840135", "1530480473", "100000192769786", "9214669", "503823919", "1561346449", "35803977", "100000831925386", "10234776", "647598161", "680075409", "1704589865", "100000359676120", "511851525", "1054530633", "737958046", "533053311", "1104042106", "781488288", "7924864", "613380553", "1367975616", "1684112913", "1350510259", "100000733788308", "100000174252043", "1312673122", "1362780275", "wZp6TeJuD1", "669798314", "l5kZgcmZMN", "1150433686", "1544417048", "e6CrBKWKRB", "4YoBAPHCnW", "x_VwgeR_CL", "1227212586", "100003439586515", "vYIuxZxB7M", "VF_pnGeJmF", "100003144851770", "1033440047", "1200090422", "600225906", "r7uOyDLdZ6", "546547222", "1013628582", "100004182760689", "100000433033574", "x_GPoOeJN9", "1029905862", "ZtQ7LJd5U0", "1579590792", "722582958", "100001031395631", "1548780406", "700291386", "RhEJXycuBn", "1222740405", "1119276052", "1215212586", "614643032", "518062268", "100001535179052", "640081938", "1515976994", "1376873628", "100000096696080", "703222470", "100002525981939", "750030575", "1599810255", "683879852", "748768941", "1132533057", "1213984046", "583067495", "682657424", "1386141848", "Vg_lRuaSSn", "2201890", "1499709657", "100000348666468", "zhPsFPo454", "569218387", "675730698", "669269481", "1138541839", "1287060173", "568325558", "100003031194646", "100002547755423", "660744940", "s2AFrgPB0H", "Mb7Ta8LGd2", "1420231548", "724686420", "687025385", "FXlTPe3jq0", "1540080605", "1461939538", "769615569", "1282974260", "YbzEXdWYop", "1530000127", "648095076", "103186326386845", "669030604", "CNowSjl7gU", "17817675", "589661242", "jFld5c-Yev", "1250835139", "1094982799", "100000542815149", "heDfq0ggo3", "748240227", "625131", "3bAMF94ETG", "nnkIsg7gua", "1559636789", "100000655680180", "525938154", "72000152", "567017042", "100003251016817", "100003957650243", "247708342011192", "1462260006", "100000741751947", "1077512589", "852330412", "706042641", "esp5WpKMBs", "1416551208", "100001852337603", "100001043993430", "1445994995", "100004207260527", "1128744282", "GNmUDonMye", "742283485", "625293082", "1049778987", "100005072350320", "1059995505", "100003589157707", "583974581", "5318639", "hlZN_7Xg29", "1343881146", "100000253452371", "1443802995", "100000292122701", "HaT4FcvWmw", "543741721", "1796002262", "HCO_013V1I", "707956938", "507684", "1358701136", "1449546028", "636345249", "ExMu9aPaEL", "1343953929", "1265991969", "1043079251", "506840001", "100002527942614", "830749045", "9y4AOytrsy", "8i5DobsUQ5", "oYPU4EfRgn", "ffchxz2TC7", "le4qMRkxRq", "21410815", "3416338", "100004856234002", "maXha5oxnc", "1619803242", "1027623173", "606529391", "610328763", "1189551283", "100002217303482", "100000151623719", "100001182103923", "1504721039", "4U7yK1WdQB", "100000393991110", "513557734", "ZcS23StOM8", "1026419824", "654287741", "UyPKdoARnF", "541686778", "KyAayZjy3k", "1085397357", "1524000008", "eCk58phccB", "775255226", "1825821089", "706039468", "_79NU0futZ", "1144981034", "XMW_5v6Ynd", "1295520098", "618230365", "588087789", "603269546", "5KXxbLV409", "1205684995", "578433053", "1379988203", "XN7Kbul9cN", "684665416", "1251462014", "1644743041", "805378628", "1829115735", "1541100042", "eOXVzboOSR", "uwX4Qpj5LZ", "G5RuarzBTz", "3KbLjAFP9V", "1119216234", "100002835293957", "1531710117", "509154261", "769026797", "141400709", "617550473", "567621779", "dGBNn4Ftiq", "100004007928292", "100000207066820", "624817999", "503979529", "1535395696", "100000603196443", "zX8vJ2gkC4", "584387208", "1568343442", "512187596", "wL9AkskKAz", "100000142400143", "739223014", "1522080521", "lHdUUd8527", "725611415", "39609703", "J7sO5GLeI9", "1PlXpbOHOc", "1529520345", "513304038", "EOHQ27ggNU", "29621392", "MLIITAYvX3", "1174442491", "1241587440", "681303046", "590613791", "832425712", "1578601395", "0hehNjGHrH", "783255121", "699820063", "500766118", "100000050783686", "KPYjSHFlij", "519260084", "1318682415", "1036200053", "686876290", "DdX6l9s4BY", "1604083639", "1472286971", "756572769", "100000021442214", "1415802306", "100001676973404", "1253950946", "1256520521", "533536768", "6KNuKw1Cc5", "100001784541667", "1538521000", "584189010", "527325794", "211897", "512140833", "100003532344995", "1336983709", "1178923656", "1234687041", "831559896", "oD264n4oXD", "0uPijuOcuK", "fdAlvNdyMD", "R0iR8sJ65A", "wM1LklqhIt", "802924310", "1318633354", "1347155989", "641058017", "1205304161", "617675915", "100004769976922", "100004795440122", "1073670251", "1320904322", "556150546", "1313617204", "1951760", "y7C_5_FBil", "701215203", "1229430023", "100000461688530", "1456839656", "1139670036", "100002762450273", "1579731508", "1547970568", "1315250242", "100001389412980", "100003199272117", "100001870129757", "591530072", "1414095852", "100003617098959", "aPiD1ScFID", "z0XuDSCPhd", "100003463668114", "720845679", "1338810015", "1064790236", "653585611", "1384302392", "606798222", "1194960231", "1223010055", "719686998", "725706549", "100000913544987", "100003679895417", "1144035331", "100003199272117", "534821747", "727868666", "1594946341", "1283708080", "1685977996", "591900001", "100003373697854", "727563343", "100003890925946", "598868176", "1711109", "1671720028", "1016118990", "1608091020", "644521352", "1353746356", "24610757", "1479240040", "539525014", "546705108", "fPCb0FlYfv", "724310440", "100000475584239", "1654505149", "1073670243", "682451301", "614328571", "100000196510465", "1539728145", "596980817", "790393012", "515142419", "654518125", "1548060442", "1666472260", "566965775", "aObPl_Qihd", "1439264891", "1369440840", "719441859", "100000617307005", "100003748650984", "1330143911", "2oKi0x1aCd", "1020201419", "1474920132", "1152230487", "690988057", "8110059", "vO0PtqvVGv", "829571037", "GQ_mI0jItW", "100000184974433", "563014348", "100000685474296", "727687945", "1396364864", "1133592696", "1451138888", "739570718", "1058850057", "100005054464313", "100000386678180", "1505520124", "500057925", "1479420265", "1548270501", "oml7fakky8", "100002441110503", "1275905707", "712206284", "598672073", "520176571341717"]

  IMAGES = Dir.entries("#{Rails.root}/data/fake_images").sort
  IMAGES.delete_at(1)
  IMAGES.delete_at(0)

  task :do_all => [:destroy_data, :create_me, :calendar]
  
  task :destroy_data => :environment do
    [Calendar, CalendarFollower, CalendarRole, Event, Relationship, UserAuthentication, UserRole].each do |model|
      model.destroy_all
    end
  end
  
  task :create_me => :environment do
    username = ENV['USER']
    puts username
    if username == "mradmin"
      username1 = "cmmartin"
      username2 = "scott"
      user_email = "cmmartin24@gmail.com" if username == "mradmin"
      user_email2 = "scott@scoran.com" if username == "mradmin"
      @my_user = User.find_or_initialize_by_email(user_email)
      @my_user = User.create!(Object.const_get username1.upcase) if @my_user.new_record?
      @my_user.user_roles.find_or_create_by_role(:admin) unless @my_user.is("admin")

      @my_user2 = User.find_or_initialize_by_email(user_email2)
      @my_user2 = User.create!(Object.const_get username2.upcase) if @my_user2.new_record?
      @my_user2.user_roles.find_or_create_by_role(:admin) unless @my_user2.is("admin")

    else
      user_email = "cmmartin24@gmail.com" if username == "cmmartin"
      user_email = "scott@scoran.com" if username == "scott"
      @my_user = User.find_or_initialize_by_email(user_email)
      @my_user = User.create!(Object.const_get username.upcase) if @my_user.new_record?
      @my_user.user_roles.find_or_create_by_role(:admin) unless @my_user.is("admin")
      puts @my_user.email
    end
  end

  task :calendar => :environment do
    (1..25).each do |d|
      user = make_user
    end
    create_events
  end
  
  def make_user
    user                        = User.new
    user.first_name             = Faker::Name.first_name
    user.last_name              = Faker::Name.last_name
    user.email                  = Faker::Internet.email
    user.password               = "rumorsource"
    user.password_confirmation  = "rumorsource"
    user.save!
    user.user_authentications.find_or_create_by_provider_and_uid("facebook", UIDS.sample)
    puts "building user #{user.first_name} #{user.last_name}"
    user
  end

  # def create_calendar(user)
  #   c = Calendar.new
  #   c.name                  = Faker::Company.name
  #   c.description           = Faker::Lorem.paragraph(sentence_count = rand(30..60))
  #   c.image                 = File.open("#{Rails.root}/data/fake_images/#{IMAGES.sample}")
  #   c.user_id               = user.id
  #   c.save
  # end
  
  def create_events
    icals = Dir.entries("#{Rails.root}/data/icals").sort
    icals.delete_at(1)
    icals.delete_at(0)
    icals.each do |ical|
      cal_file = File.open("#{Rails.root}/data/icals/#{ical}")
      calendars = Icalendar.parse(cal_file)
      calendars.each do |calendar|
        c = Calendar.new
        ctitle            = calendar.properties["x-wr_calname"]
        c.description     = Faker::Lorem.paragraph(sentence_count = rand(30..60))
        c.image           = File.open("#{Rails.root}/data/fake_images/#{IMAGES.sample}")
        c.user_id         = User.order("RANDOM()").first.id
        c.save
        calendar.events.each do |event|
          e = Event.new
          e.calendar_id = c.id
          e.user_id = c.user_id
          e.category_list = event.categories.join(", ")
          e.title       = event.summary
          e.content     = event.description
          e.latitude      = 55.3224
          e.longitude     = 58.0843
          e.start_time  = event.dtstart
          e.end_time    = event.dtend
          # e.image       = File.open("#{Rails.root}/app/assets/images/rails.png")
          e.all_day = (((e.start_time - e.end_time.to_datetime) / 3600) <= -10) ? true : false
          e.save!
          # puts "start date-time: #{e.start_time}"
          # puts "end date-time: #{e.end_time}"
          puts "summary: #{event.summary}"
          puts "description: #{event.description}"
          # puts "category: #{event.categories}"
          puts "location: #{event.location}"
        end
      end    
    end
  end
end
